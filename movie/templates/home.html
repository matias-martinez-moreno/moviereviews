{% extends 'base.html' %}
{% load static %}

{% block title %}Movie Catalog - Movie Reviews{% endblock %}

{% block extra_css %}
<style>
  .movie-card {
    transition: all 0.3s ease;
    border: none;
    border-radius: 15px;
  }
  
  .movie-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
  }
  
  .movie-card .card-img-top {
    height: 200px;
    object-fit: cover;
    border-radius: 15px 15px 0 0;
  }
  
  .movie-title {
    font-size: 1.1rem;
    font-weight: 600;
    color: #2c3e50;
    line-height: 1.3;
  }
  
  .movie-description {
    font-size: 0.9rem;
    color: #5a6c7d;
    height: 100px;
    overflow: hidden;
    line-height: 1.4;
  }
  
  .badge {
    font-size: 0.8rem;
    padding: 0.5rem 0.8rem;
  }
  
  #filterPanel {
    transition: all 0.3s ease;
  }
  
  .filter-btn-active {
    background-color: #6c757d !important;
    color: white !important;
    border-color: #6c757d !important;
  }
</style>
{% endblock %}

{% block content %}
<!-- Título de página con estilo mejorado -->
<div class="page-title">
  <div class="container">
    <h1 class="text-center">
      <i class="bi bi-film me-3"></i>Movie Catalog
    </h1>
    {% if name %}
      <p class="text-center lead mb-0 mt-2 opacity-75">
        Welcome, <strong>{{ name }}</strong>!
      </p>
    {% endif %}
  </div>
</div>

<div class="container">

  <!-- Formulario de búsqueda y filtros -->
  <form method="get" class="d-flex justify-content-center mb-4">
    <div class="input-group w-75">
      <label for="searchMovie" class="form-label visually-hidden">Search movie</label>
      <input class="form-control" type="search" placeholder="Search movie..." name="searchMovie" id="searchMovie" value="{{ request.GET.searchMovie|default:'' }}">
      <button class="btn btn-primary" type="submit">
        <i class="bi bi-search"></i> Search
      </button>
      <button class="btn btn-outline-secondary" type="button" id="filterBtn">
        <i class="bi bi-funnel"></i> Filter
      </button>
    </div>
  </form>
  
  <!-- Panel de filtros -->
  <div class="row justify-content-center mb-4" id="filterPanel" style="display: none;">
    <div class="col-md-8">
      <div class="card shadow-sm">
        <div class="card-body p-3">
          <div class="row g-2">
            <div class="col-md-4">
              <label for="genreFilter" class="form-label small mb-1">Genre</label>
              <select class="form-select form-select-sm" id="genreFilter">
                <option value="">All Genres</option>
                <option value="Drama" {% if current_genre == 'Drama' %}selected{% endif %}>Drama</option>
                <option value="Action" {% if current_genre == 'Action' %}selected{% endif %}>Action</option>
                <option value="Sci-Fi" {% if current_genre == 'Sci-Fi' %}selected{% endif %}>Sci-Fi</option>
                <option value="Crime" {% if current_genre == 'Crime' %}selected{% endif %}>Crime</option>
                <option value="Thriller" {% if current_genre == 'Thriller' %}selected{% endif %}>Thriller</option>
                <option value="Animation" {% if current_genre == 'Animation' %}selected{% endif %}>Animation</option>
                <option value="Comedy" {% if current_genre == 'Comedy' %}selected{% endif %}>Comedy</option>
                <option value="Fantasy" {% if current_genre == 'Fantasy' %}selected{% endif %}>Fantasy</option>
              </select>
            </div>
            <div class="col-md-4">
              <label for="yearFilter" class="form-label small mb-1">Year</label>
              <select class="form-select form-select-sm" id="yearFilter">
                <option value="">All Years</option>
                <option value="1990" {% if current_year == '1990' %}selected{% endif %}>1990s</option>
                <option value="2000" {% if current_year == '2000' %}selected{% endif %}>2000s</option>
                <option value="2010" {% if current_year == '2010' %}selected{% endif %}>2010s</option>
                <option value="2020" {% if current_year == '2020' %}selected{% endif %}>2020s</option>
              </select>
            </div>
            <div class="col-md-4 d-flex align-items-end">
              <button class="btn btn-success btn-sm w-100" type="button" id="applyFilters">
                <i class="bi bi-check-circle"></i> Apply
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Formulario de suscripción -->
  <form method="post" action="/signup" class="d-flex justify-content-center mb-5">
    {% csrf_token %}
    <div class="input-group w-50">
      <label for="email" class="form-label visually-hidden">Email for subscription</label>
      <input class="form-control" type="email" placeholder="Subscribe to our newsletter..." name="email" id="email" required>
      <button class="btn btn-success" type="submit">
        <i class="bi bi-envelope"></i> Subscribe
      </button>
    </div>
  </form>

  <!-- Lista de películas -->
  <div class="row row-cols-1 row-cols-sm-2 row-cols-md-2 row-cols-lg-3 g-4">
    {% for movie in movies %}
      <div class="col">
        <div class="card h-100 shadow-sm movie-card">
          {% if movie.image %}
            <img src="{{ movie.image.url }}" class="card-img-top" alt="{{ movie.title }}">
          {% else %}
            <img src="{% static 'placeholder.png' %}" class="card-img-top" alt="No image">
          {% endif %}
          <div class="card-body d-flex flex-column p-4 py-4">
            <h6 class="card-title movie-title mb-2">{{ movie.title }}</h6>
            <p class="card-text movie-description mb-3">{{ movie.description }}</p>
            <div class="mt-auto">
              <div class="mb-2">
                {% if movie.genre %}
                  <span class="badge bg-primary me-1">{{ movie.genre }}</span>
                {% endif %}
                {% if movie.year %}
                  <span class="badge bg-secondary">{{ movie.year }}</span>
                {% endif %}
              </div>
              {% if movie.url %}
                <a href="{{ movie.url }}" class="btn btn-outline-primary btn-sm" target="_blank">
                  <i class="bi bi-box-arrow-up-right"></i> View More
                </a>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    {% empty %}
      <div class="col-12">
        <div class="alert alert-info text-center">
          <i class="bi bi-exclamation-circle"></i> No movies found.
        </div>
      </div>
    {% endfor %}
  </div>
</div>

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  const filterBtn = document.getElementById('filterBtn');
  const filterPanel = document.getElementById('filterPanel');
  const genreFilter = document.getElementById('genreFilter');
  const yearFilter = document.getElementById('yearFilter');
  const applyFilters = document.getElementById('applyFilters');
  
  // Toggle del panel de filtros
  filterBtn.addEventListener('click', function() {
    if (filterPanel.style.display === 'none') {
      filterPanel.style.display = 'block';
      filterBtn.classList.add('filter-btn-active');
    } else {
      filterPanel.style.display = 'none';
      filterBtn.classList.remove('filter-btn-active');
    }
  });
  
  // Aplicar filtros
  applyFilters.addEventListener('click', function() {
    const genre = genreFilter.value;
    const year = yearFilter.value;
    const searchTerm = document.getElementById('searchMovie').value;
    
    let url = '/?';
    const params = [];
    
    if (searchTerm) params.push(`searchMovie=${encodeURIComponent(searchTerm)}`);
    if (genre) params.push(`genre=${encodeURIComponent(genre)}`);
    if (year) params.push(`year=${encodeURIComponent(year)}`);
    
    if (params.length > 0) {
      url += params.join('&');
      window.location.href = url;
    }
  });
  
  // Presionar Enter en los filtros
  [genreFilter, yearFilter].forEach(filter => {
    filter.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        applyFilters.click();
      }
    });
  });
});
</script>
{% endblock %}
{% endblock %}
